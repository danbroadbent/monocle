<div id="map"></div>
<script>
  function initMap() {
    var uluru = <%= @user_coordinates.html_safe %>;
    var bounds = new google.maps.LatLngBounds();
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 15,
      center: uluru
    });
    <% @companies.each do |company| %>
      var coordinates = <%= company.get_coordinates.html_safe %>;
      var marker = new google.maps.Marker({
        position: coordinates,
        map: map
      });
      bounds.extend(marker.getPosition());
    <% end %>

    map.setCenter(bounds.getCenter());
  }
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['google_maps_key'] %>&callback=initMap">
</script>
<%= render partial: "shared/companies_index", locals: {companies: @companies} %>
